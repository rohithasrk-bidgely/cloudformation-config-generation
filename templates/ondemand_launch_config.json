{
  "OnDemandLaunchConfiguration": {
    "Type": "AWS::AutoScaling::LaunchConfiguration",
    "Properties": {
      "BlockDeviceMappings": [
        {
          "DeviceName": "/dev/sda1",
          "Ebs": {
            "VolumeSize": 30,
            "VolumeType": "gp2",
            "DeleteOnTermination": true
          }
        }
      ],
      "EbsOptimized": true,
      "IamInstanceProfile": "dev-iam-instance-profile",
      "ImageId": "ami-8f30fcf7",
      "InstanceMonitoring": false,
      "InstanceType": "m4.large",
      "LaunchConfigurationName": "$NAME-ondemand-lc-$TAGENV",
      "SecurityGroups": [
        "sg-f0ccb68f",
        "sg-b3c2b8cc"
      ],
      "UserData": {
        "Fn::Base64": {
          "Fn::Join": [
            "",
            [
              "#!/bin/bash -xe\n",
              "AWS_REGION=",
              {
                "Ref": "AWS::Region"
              },
              "\n",
              "TAGCOMPONENT=daemons\n",
              "TAGNAME=daemons\n",
              "PACKAGELIST=\"coreToolServices\"\n",
              "JAVA_HOME=/usr/lib/jvm/java-8-oracle/jre\n",
              "INSTANCE_ID=`curl http://169.254.169.254/latest/meta-data/instance-id`\n",
              "aws ec2 create-tags --resources $INSTANCE_ID --tags Key=Name,Value=$TAGNAME Key=Environment,Value=$ENV_ID Key=Component,Value=$TAGCOMPONENT --region $AWS_REGION\n"
            ]
          ]
        }
      }
    }
  }
}  
